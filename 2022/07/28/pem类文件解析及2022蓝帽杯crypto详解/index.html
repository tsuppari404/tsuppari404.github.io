<!-- build time:Wed Sep 20 2023 19:25:40 GMT+0800 (中国标准时间) --><!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="蒟蒻的入土史" href="https://tsuppari404.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="蒟蒻的入土史" href="https://tsuppari404.github.io/atom.xml"><link rel="alternate" type="application/json" title="蒟蒻的入土史" href="https://tsuppari404.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><link rel="canonical" href="https://tsuppari404.github.io/2022/07/28/pem%E7%B1%BB%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E5%8F%8A2022%E8%93%9D%E5%B8%BD%E6%9D%AFcrypto%E8%AF%A6%E8%A7%A3/"><title>pem类文件解析及2022蓝帽杯crypto详解 | T5uppari = 蒟蒻的入土史</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><meta name="generator" content="Hexo 6.0.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">pem类文件解析及2022蓝帽杯crypto详解</h1><div class="meta"><span class="item" title="Created: 2022-07-28 09:48:52"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">Posted on</span> <time itemprop="dateCreated datePublished" datetime="2022-07-28T09:48:52+08:00">2022-07-28</time></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="Toggle navigation bar"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">T5uppari</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><img src="https://i.loli.net/2020/10/30/Z5W6r2BSoiThHG1.jpg"></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">Home</a></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="default"><link itemprop="mainEntityOfPage" href="https://tsuppari404.github.io/2022/07/28/pem%E7%B1%BB%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E5%8F%8A2022%E8%93%9D%E5%B8%BD%E6%9D%AFcrypto%E8%AF%A6%E8%A7%A3/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/head.jpg"><meta itemprop="name" content="tsuppari"><meta itemprop="description" content=", "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="蒟蒻的入土史"></span><div class="body md" itemprop="articleBody"><p><strong>本文首发于跳跳糖社区（<span class="exturl" data-url="aHR0cHM6Ly90dHRhbmcuY29tL2FyY2hpdmUvMTY3MCVFRiVCQyU4OQ==">https://tttang.com/archive/1670）</span></strong></p><p>对 pem 类文件的浅析</p><span id="more"></span><h3 id="pem文件"><a class="anchor" href="#pem文件">#</a> pem 文件</h3><p>pem 格式的文件通常用于数字证书认证机构 (Certificate Authorities，CA)，其文件形式主要为<strong> base64 编码</strong>的文件，头尾有类似于 <code>-----BEGIN PUBLIC KEY-----</code> 和 <code>-----END PUBLIC KEY-----</code> 的头尾标记。</p><h3 id="生成公私钥"><a class="anchor" href="#生成公私钥">#</a> 生成公私钥</h3><p>在 python 中，可以通过安装包 <code>from Crypto.PublicKey import RSA</code> 生成想要的公私钥文件</p><h4 id="public-key"><a class="anchor" href="#public-key">#</a> public key</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p,q = getPrime(<span class="number">512</span>),getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">pub = RSA.construct((n,e))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.pem&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(pub.exportKey(<span class="string">&#x27;PEM&#x27;</span>))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.pem&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.read().decode())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">-----BEGIN PUBLIC KEY-----</span></span><br><span class="line"><span class="string">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCuRPouMRTcLWPBEUlhjCrZ6MNQ</span></span><br><span class="line"><span class="string">rSy29BrHjH4+lGMykB23azPtT9fk7IsEFXoodm6tsPL8kheJ6cP+0WPldlQOw/K3</span></span><br><span class="line"><span class="string">c9LUGzeCCAhNJuBjUoeW32ruE2HS7RoIF6vkP36zLs167ZZMK7Fg0cqW6VNXoJHT</span></span><br><span class="line"><span class="string">zaKdqysBe+3W1VHl6QIDAQAB</span></span><br><span class="line"><span class="string">-----END PUBLIC KEY-----</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><h4 id="private-key"><a class="anchor" href="#private-key">#</a> private key</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p,q = getPrime(<span class="number">512</span>),getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">d = inverse(e,(p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line">pub = RSA.construct((n,e,d,p,q))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.pem&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(pub.exportKey(<span class="string">&#x27;PEM&#x27;</span>))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.pem&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.read().decode())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIICXAIBAAKBgQCnHIvLP0IERPVRaED+71dlCRBcm3be4jlHgqVqIIXyIvrzc8ZC</span></span><br><span class="line"><span class="string">IIbIDqlBybNgq32i6PVlzBCsWiiTfBYS6J24qCjYVTywKk+yieNshieNNohmvQRF</span></span><br><span class="line"><span class="string">bZOZITJiP99URkhtGWo3trQfoAZEQ7NfMoS1N3PDvPet1lMfFK81AyWt1wIDAQAB</span></span><br><span class="line"><span class="string">AoGAIq74DK0KZJxzVfwPUVoXh27EKJRTrZrCTKc+8bHiWwkLkK+8vEjH8Imqc28L</span></span><br><span class="line"><span class="string">fcrZ/o/fLsuVwk/MECA27KG+6hiRPJDWZmFgCInCABuhd+xitSBciMSGrO5ITjoq</span></span><br><span class="line"><span class="string">YdgMsR5xJTI8vhXIJ1iCkkCz6fD6Di7s+3n/+Ti3iuK87jECQQDOY/pLyH0ppOk0</span></span><br><span class="line"><span class="string">49pieQRshckQMXqsKhahEDZmWMu70JqDLF0U3aIfup1R87uogB8hJj8+K5RQavG4</span></span><br><span class="line"><span class="string">4l0W5ghTAkEAz0eTNEWTe2iJ/Dq+8JKTN/MA/a8MiG7wvAkXqjx+B+Eow77IdoN8</span></span><br><span class="line"><span class="string">D5ehD0x6ou73yaorTddidDAplNmvyq0D7QJAJbcPXhndBWclVozss2H59Prdqx/f</span></span><br><span class="line"><span class="string">kuZ+DCCyUDGZyVBta9sHh3CY18N6TCeF+1yuU5hxpiLAj5F7apWy/SQ8EQJBAMtv</span></span><br><span class="line"><span class="string">AxGda6cGLc8o1PeF1AlobUONxy4sPAdAoUJKRqNzH7AmEdcHKv6eoctDE2XQRc9e</span></span><br><span class="line"><span class="string">PUwTpSRFlLnrgLXZYu0CQBKKT+oY4ssnwKDQqGPsh9MtPyilySL9sWJilk1cSXmQ</span></span><br><span class="line"><span class="string">Xm7gjDq5S/x4k1gJyQFXbUnxTfsbLWs6BljHHlKSRes=</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>如果是生成一组随机的公私钥文件，可以直接直接使用 <code>RSA.generate(bits)</code> ，其中的 bits 参数为生成的公钥文件中 n 的二进制位数，且 bits&gt;=1024，默认为 1024。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">key = RSA.generate(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">print</span>(key.publickey)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.pem&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(key.exportKey(<span class="string">&#x27;PEM&#x27;</span>))</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;out.pem&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.read().decode())</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">&lt;bound method RsaKey.public_key of RsaKey(n=99929675131146107818047790971049703803161677332600984800831117021637597471437271599719384035180982326470249457001083005224626356572009901255841391966616564984242588913592789383087326511196585443834216472384770224810255153922375944881215835774119177009570247468911673932973239275741131654695253944455708641727, e=65537, d=27501740780061900509028777360107084282858928440567277451824014559115713670042546183199393779857817534085793587304881725189343016621314014739780326627796196251470626677550096120689732366473717193895036548926100990548453802714993577259273117223098888966957225092204230317866243049867167880710514827901086931493, p=9959145719455053414348729655771312861460726396890001110536788452571591154277537325754067618769136991544158484849077735057792084414015625760536769751415507, q=10033960536990122517580769502852456118641921945920255759007869111269242067226468943041901092934902353013133963062909073461567977701122665256982872188799461, u=2111771661302217183343493746406805348965531581492223651147849337466575464897027597797323383307376291792334461891498947953036261381547003770335520720819326)&gt;</span></span><br><span class="line"><span class="string">-----BEGIN RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">MIICXQIBAAKBgQCOTfkFWAc5UsCT07Y4bU9jKfpT5pt+ScHFIk/39jsE8yDHSFAo</span></span><br><span class="line"><span class="string">pcQMlJ6GKRYfU7F/3xbY2udbvXBj9jJVLBmh3ORbZT06xwYDeqhvE2kJB+QfGk+J</span></span><br><span class="line"><span class="string">POqzjCkFiDorxMUzWEq4us8nXmkv6WsrJMGSQZ0SQ7c29N9M0/8K622JvwIDAQAB</span></span><br><span class="line"><span class="string">AoGAJyntaVuXLV8JcgW3piLrUNLKOpICZEi/Q9ZUJN2G069n64CK0wz//ihe0nR3</span></span><br><span class="line"><span class="string">SqrZdGQ84PSp7LUfu9sTch5fdSQLH/OAQtVf/rwWuwulm8wS0njrU9xxQQWrwZoe</span></span><br><span class="line"><span class="string">L9W7DlBWf5+PbmYdgyoLIwL3+wskvxiWswlvVcSR7RkXGiUCQQC+J0pN+1W2U3qe</span></span><br><span class="line"><span class="string">a8rhAwX7XMSXoblFuqfBfH/duLZvseEEjtuTcj0ISlJgts2aZT1J8yHnllUoiqAu</span></span><br><span class="line"><span class="string">WQPUK/rTAkEAv5T6OwPHj+4J/4WzQgJTN89Xj9ihR45wpr8Rr6WPXUCgXTe82UFz</span></span><br><span class="line"><span class="string">ny68nIzALvKrLTf58yu8/E5wy2+SejBJ5QJASNUnwsK3y8QhvTgwVwsfaW3Y5vNM</span></span><br><span class="line"><span class="string">0YZy5stW9offaNzLAUHunIUvF1PQRbb+/Vo1pXN40wljyMmAHQB/VO8bfQJBAIGQ</span></span><br><span class="line"><span class="string">nVKAEdyzHavjngHMVL9vyEYOObSNDn6Wxb1GeJiWdl3UrjE35JwJHaG6Rtb5Yu7n</span></span><br><span class="line"><span class="string">5nCgaeUwn3PV9vgP5EkCQQCWIiD5b8Qb5Mma8/iDNhchmRkosUug/iCBeqNh3nJc</span></span><br><span class="line"><span class="string">txZnUy1fjc0toXxJY3ZBzTl3TNsk8p8x4H9y/NXoDtvu</span></span><br><span class="line"><span class="string">-----END RSA PRIVATE KEY-----</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure><p>其中有 <code>n,e,d,p,q,u</code> 公 6 个参数，其中<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>=</mo><msup><mi>p</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mtext></mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext></mtext><mi>q</mi></mrow><annotation encoding="application/x-tex">u=p^{-1} \bmod q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span></span></span></span>。</p><h3 id="使用公私钥加密或解密文件"><a class="anchor" href="#使用公私钥加密或解密文件">#</a> 使用公私钥加密或解密文件</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">flag = <span class="string">b&#x27;This_is_a_message_qwer&#x27;</span></span><br><span class="line"></span><br><span class="line">key = RSA.generate(<span class="number">1024</span>)</span><br><span class="line">pub = key.publickey().exportKey()</span><br><span class="line">public_key = RSA.importKey(pub)</span><br><span class="line">pk = PKCS1_OAEP.new(public_key)</span><br><span class="line">enc = pk.encrypt(flag)</span><br><span class="line"><span class="built_in">print</span>(enc)</span><br><span class="line"></span><br><span class="line">priv = key.exportKey()</span><br><span class="line">priv_key = RSA.importKey(priv)</span><br><span class="line">sk = PKCS1_OAEP.new(priv_key)</span><br><span class="line">msg = sk.decrypt(enc)</span><br><span class="line"><span class="built_in">print</span>(msg)</span><br><span class="line"><span class="string">b&#x27;\xd1/Ou\xae\xba]z\xc0\t\xc6\xd7\xc4f\x13\x96\x9a\xeb5\xdb8\x92\xc7\x19\x12y\x9c\x18\xf7A\x9d\xe9\n&amp;=&lt;\x16\x07\xefz\xad2-\x983\xec\x932\xcb\xf0\x87~\xdf\xc1\xd2\x9f\xd7@\\H\x1f\x87#\xf3\x84\xa0\xfc\xd9\xcfV$&gt;\xd7Of\xe6G\x06\xcb\x91\xa1\xcc\x0c\xad\xc2\x9a\xad\xe46\x91x\xad\xa51\xbb\xfb\xc1E\x93~e%\xd1~\xf8l\x19n\x88\xff\xac^\xca\x8fs*&#125;\xb9c0\xc0N\xf2\xfa\xa4\xd8\x18g&#x27;</span></span><br><span class="line"><span class="string">b&#x27;This_is_a_message_qwer&#x27;</span></span><br></pre></td></tr></table></figure><h3 id="解析公私钥"><a class="anchor" href="#解析公私钥">#</a> 解析公私钥</h3><h4 id="openssl"><a class="anchor" href="#openssl">#</a> openssl</h4><p>openssl 是 linux 系统里一个开源的的软件包，应用程序通过 openssl 加密通信避免窃听，主要库为 C 语言写成。openssl 还支持许多加密算法，例如 RSA、DSA、ECDSA、ECDHE、Diffie–Hellman key exchange 等。本文主要介绍 openssl 用于 RSA 中 pem 文件的加解密。</p><h5 id="读取公钥pem"><a class="anchor" href="#读取公钥pem">#</a> 读取公钥 pem</h5><p><code>openssl rsa -pubin -text -modulus -in 1.pem</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/tmp]</span><br><span class="line">└─<span class="comment"># openssl rsa -pubin -text -modulus -in 1.pem </span></span><br><span class="line">RSA Public-Key: (1024 bit)</span><br><span class="line">Modulus:</span><br><span class="line">    00:8f:36:54:4b:9c:ac:89:f9:76:b1:3c:16:8c:10:</span><br><span class="line">    db:99:4c:e9:95:92:ab:03:e9:31:d3:41:6f:a3:52:</span><br><span class="line">    da:fe:66:<span class="built_in">fc</span>:9a:4e:22:37:98:73:b3:c2:97:e6:42:</span><br><span class="line">    ee:9b:04:ae:2d:5d:d0:3d:6f:09:9f:e7:44:35:b0:</span><br><span class="line">    2f:3b:b2:41:8a:b1:3c:2b:d5:97:c1:8e:77:<span class="built_in">df</span>:8b:</span><br><span class="line">    d1:06:02:c3:35:42:d3:f0:fb:ec:a7:af:13:5c:1b:</span><br><span class="line">    96:97:92:15:7b:35:a9:b3:58:d7:ba:f0:d1:45:9f:</span><br><span class="line">    c8:d5:05:59:e7:ff:4d:8a:97:93:29:a0:7e:50:ab:</span><br><span class="line">    6d:2e:e6:45:7e:74:b0:4b:3d</span><br><span class="line">Exponent: 65537 (0x10001)</span><br><span class="line">Modulus=8F36544B9CAC89F976B13C168C10DB994CE99592AB03E931D3416FA352DAFE66FC9A4E22379873B3C297E642EE9B04AE2D5DD03D6F099FE74435B02F3BB2418AB13C2BD597C18E77DF8BD10602C33542D3F0FBECA7AF135C1B969792157B35A9B358D7BAF0D1459FC8D50559E7FF4D8A979329A07E50AB6D2EE6457E74B04B3D</span><br><span class="line">writing RSA key</span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCPNlRLnKyJ+XaxPBaMENuZTOmV</span><br><span class="line">kqsD6THTQW+jUtr+ZvyaTiI3mHOzwpfmQu6bBK4tXdA9bwmf50Q1sC87skGKsTwr</span><br><span class="line">1ZfBjnffi9EGAsM1QtPw++ynrxNcG5aXkhV7NamzWNe68NFFn8jVBVnn/02Kl5Mp</span><br><span class="line">oH5Qq20u5kV+dLBLPQIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><p>其中 <code>Modulus</code> 为模数 <code>n</code> 的 16 进制下的值， <code>Exponent</code> 为加密指数 <code>e</code> 。</p><h5 id="读取私钥pem"><a class="anchor" href="#读取私钥pem">#</a> 读取私钥 pem</h5><p><code>openssl rsa -in 1.pem -text</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">┌──(root㉿kali)-[/tmp]</span><br><span class="line">└─<span class="comment"># openssl rsa -in 1.pem -text                </span></span><br><span class="line">RSA Private-Key: (1024 bit, 2 primes)</span><br><span class="line">modulus:</span><br><span class="line">    00:8f:36:54:4b:9c:ac:89:f9:76:b1:3c:16:8c:10:</span><br><span class="line">    db:99:4c:e9:95:92:ab:03:e9:31:d3:41:6f:a3:52:</span><br><span class="line">    da:fe:66:<span class="built_in">fc</span>:9a:4e:22:37:98:73:b3:c2:97:e6:42:</span><br><span class="line">    ee:9b:04:ae:2d:5d:d0:3d:6f:09:9f:e7:44:35:b0:</span><br><span class="line">    2f:3b:b2:41:8a:b1:3c:2b:d5:97:c1:8e:77:<span class="built_in">df</span>:8b:</span><br><span class="line">    d1:06:02:c3:35:42:d3:f0:fb:ec:a7:af:13:5c:1b:</span><br><span class="line">    96:97:92:15:7b:35:a9:b3:58:d7:ba:f0:d1:45:9f:</span><br><span class="line">    c8:d5:05:59:e7:ff:4d:8a:97:93:29:a0:7e:50:ab:</span><br><span class="line">    6d:2e:e6:45:7e:74:b0:4b:3d</span><br><span class="line">publicExponent: 65537 (0x10001)</span><br><span class="line">privateExponent:</span><br><span class="line">    1b:5b:06:de:0c:96:de:a2:22:bc:77:1c:5d:73:e8:</span><br><span class="line">    e6:8f:0c:fd:4f:af:50:07:6e:c7:8a:33:cf:70:47:</span><br><span class="line">    b9:99:a5:7d:ba:18:0a:23:9a:52:47:84:e9:6c:76:</span><br><span class="line">    94:70:<span class="built_in">df</span>:ee:75:81:8e:02:94:45:91:90:f3:6a:6c:</span><br><span class="line">    93:4c:18:fd:a2:75:d5:18:9a:81:1d:38:ec:85:c3:</span><br><span class="line">    33:f6:1e:69:0a:27:d5:ba:12:5d:1d:86:ac:4e:14:</span><br><span class="line">    dc:e1:ad:f7:0b:64:ac:6a:3c:58:f7:c1:1c:5c:4f:</span><br><span class="line">    d9:91:9a:05:c3:de:a0:2f:4c:43:28:da:33:9b:fe:</span><br><span class="line">    60:a5:31:83:2f:ce:d8:51</span><br><span class="line">prime1:</span><br><span class="line">    00:bc:a4:41:8f:de:bc:c4:cc:c3:4b:ac:7e:65:da:</span><br><span class="line">    f9:53:0b:53:d7:e9:f2:11:8b:fd:03:96:27:ca:f6:</span><br><span class="line">    cb:02:ba:fd:60:51:56:78:64:7d:37:b5:b8:ee:92:</span><br><span class="line">    12:57:ce:5f:be:96:32:40:48:47:fb:ea:8f:75:bb:</span><br><span class="line">    60:c1:90:c1:e9</span><br><span class="line">prime2:</span><br><span class="line">    00:c2:59:5e:53:6e:a6:17:33:ea:00:72:87:da:0b:</span><br><span class="line">    55:36:0f:<span class="built_in">cd</span>:40:25:c6:e3:2c:b8:a3:4f:e5:13:9d:</span><br><span class="line">    80:b2:76:78:66:04:88:51:13:fa:3e:7e:<span class="built_in">fc</span>:08:f7:</span><br><span class="line">    06:6b:3b:ce:09:bd:cc:46:91:e7:b7:74:8a:52:e4:</span><br><span class="line">    f7:66:a9:36:35</span><br><span class="line">exponent1:</span><br><span class="line">    4e:a6:3d:1f:7a:c2:41:5b:0d:e1:b3:1d:4f:e2:28:</span><br><span class="line">    29:53:83:b5:75:b8:93:50:46:41:04:8d:ba:b5:82:</span><br><span class="line">    96:b4:d7:87:1c:e2:6c:77:99:2d:6c:fa:99:9d:15:</span><br><span class="line">    40:be:ae:74:8b:b2:8f:d2:93:10:99:0f:0f:0a:<span class="built_in">fc</span>:</span><br><span class="line">    a0:37:76:61</span><br><span class="line">exponent2:</span><br><span class="line">    22:2f:a6:2f:f6:de:b0:66:29:5b:3a:ca:3a:c8:93:</span><br><span class="line">    8c:96:ea:fb:c5:a9:5e:7c:97:5d:e2:c7:e0:d3:6b:</span><br><span class="line">    b7:f8:ae:e5:03:17:17:6b:f4:30:da:15:6b:5e:48:</span><br><span class="line">    7a:c4:62:51:c4:59:12:70:c7:d9:b5:5e:3f:86:97:</span><br><span class="line">    1e:2f:d5:a1</span><br><span class="line">coefficient:</span><br><span class="line">    00:83:55:17:ad:1a:fe:bb:ac:04:d5:f7:92:ee:1a:</span><br><span class="line">    b4:37:a9:28:e2:e9:73:3f:14:b3:d0:2d:8f:56:28:</span><br><span class="line">    d5:55:22:9d:56:27:de:18:67:e5:b4:96:42:ca:8f:</span><br><span class="line">    b0:b9:60:fb:23:9f:ab:62:3b:19:92:2c:0c:6a:31:</span><br><span class="line">    b9:ad:09:0b:3c</span><br><span class="line">writing RSA key</span><br><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICXAIBAAKBgQCPNlRLnKyJ+XaxPBaMENuZTOmVkqsD6THTQW+jUtr+ZvyaTiI3</span><br><span class="line">mHOzwpfmQu6bBK4tXdA9bwmf50Q1sC87skGKsTwr1ZfBjnffi9EGAsM1QtPw++yn</span><br><span class="line">rxNcG5aXkhV7NamzWNe68NFFn8jVBVnn/02Kl5MpoH5Qq20u5kV+dLBLPQIDAQAB</span><br><span class="line">AoGAG1sG3gyW3qIivHccXXPo5o8M/U+vUAdux4ozz3BHuZmlfboYCiOaUkeE6Wx2</span><br><span class="line">lHDf7nWBjgKURZGQ82psk0wY/aJ11RiagR047IXDM/YeaQon1boSXR2GrE4U3OGt</span><br><span class="line">9wtkrGo8WPfBHFxP2ZGaBcPeoC9MQyjaM5v+YKUxgy/O2FECQQC8pEGP3rzEzMNL</span><br><span class="line">rH5l2vlTC1PX6fIRi/0DlifK9ssCuv1gUVZ4ZH03tbjukhJXzl++ljJASEf76o91</span><br><span class="line">u2DBkMHpAkEAwlleU26mFzPqAHKH2gtVNg/NQCXG4yy4o0/lE52AsnZ4ZgSIURP6</span><br><span class="line">Pn78CPcGazvOCb3MRpHnt3SKUuT3Zqk2NQJATqY9H3rCQVsN4bMdT+IoKVODtXW4</span><br><span class="line">k1BGQQSNurWClrTXhxzibHeZLWz6mZ0VQL6udIuyj9KTEJkPDwr8oDd2YQJAIi+m</span><br><span class="line">L/besGYpWzrKOsiTjJbq+8WpXnyXXeLH4NNrt/iu5QMXF2v0MNoVa15IesRiUcRZ</span><br><span class="line">EnDH2bVeP4aXHi/VoQJBAINVF60a/rusBNX3ku4atDepKOLpcz8Us9Atj1Yo1VUi</span><br><span class="line">nVYn3hhn5bSWQsqPsLlg+yOfq2I7GZIsDGoxua0JCzw=</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p>其中一共有 8 个参数，分别为：</p><p><code>modulus</code> : 模数 n</p><p><code>publicExponent</code> : 加密指数 e</p><p><code>privateExponent</code> : 解密指数 d</p><p><code>prime1&amp;2</code> : 模数 n 的两个大因子 p 和 q</p><p><code>exponent1&amp;2</code> :dp 和 dq，d mod (p - 1) 和 d mod (q - 1)</p><p><code>coefficient</code> :<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>q</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mtext></mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext></mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">q^{-1} \bmod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal">p</span></span></span></span></p><h4 id="原始数据读取"><a class="anchor" href="#原始数据读取">#</a> 原始数据读取</h4><h5 id="读取公钥pem-2"><a class="anchor" href="#读取公钥pem-2">#</a> 读取公钥 pem</h5><p>例如一个 pem 公钥文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDXrGq02sFKE5Znv2GljNLThSWB</span><br><span class="line">P6N2NfV41vaADS/ZEZB6JPo0RLTg4UYZOGg5SLYQkr5IvO6thXQJ+xFduuOYl8oe</span><br><span class="line">p4BeLZLIwFnxZQIjSDe5GD/Id6wPLTDTGFB4y7aVK/D0v+y12uW44HrYAUeTCNU8</span><br><span class="line">renYB8YQwZIwuO2qZwIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br></pre></td></tr></table></figure><p>读取其中的 base64 编码并转 hex 得到</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">30819f300d06092a864886f70d010101050003818d0030818902818100d7ac6ab4dac14a139667bf61a58cd2d38525813fa37635f578d6f6800d2fd911907a24fa3444b4e0e1461938683948b61092be48bceead857409fb115dbae39897ca1ea7805e2d92c8c059f16502234837b9183fc877ac0f2d30d3185078cbb6952bf0f4bfecb5dae5b8e07ad801479308d53cade9d807c610c19230b8edaa670203010001</span><br></pre></td></tr></table></figure><p>其中</p><table><thead><tr><th>内容</th><th>解析</th></tr></thead><tbody><tr><td>3081</td><td>标签头，81 表示后面接 1bytes，82 表示后接 2bytes 表示长度</td></tr><tr><td>9f</td><td>后接上 0xdf (159) bytes 的内容</td></tr><tr><td>300d06092a864886f70d010101050003</td><td>固定序列 (具体包含的内容未知)</td></tr><tr><td>81</td><td>后面接 1bytes，为 82 则表示后接 2bytes 表示长度</td></tr><tr><td>8d</td><td>后接上 0x8d (141) bytes 的内容</td></tr><tr><td>0030</td><td>固定序列</td></tr><tr><td>81</td><td>后面接 1bytes，为 82 则表示后接 2bytes 表示长度</td></tr><tr><td>89</td><td>后接上 0x89 (137) bytes 的内容</td></tr><tr><td>0281</td><td>81 表示后面接 1bytes，82 表示后接 2bytes 表示长度</td></tr><tr><td>81</td><td>后面的模数 n 长度为 0x81bytes，但是其中 1bytes 为 00，故生成的模数二进制位数为 1024</td></tr><tr><td>00d7-67</td><td>模数 n 的 16 进制形式</td></tr><tr><td>0203010001</td><td>02 后接加密指数 e 的长度 03 即内容 010001</td></tr></tbody></table><h5 id="读取私钥pem-2"><a class="anchor" href="#读取私钥pem-2">#</a> 读取私钥 pem</h5><p>私钥的读取和公钥大同小异，但是私钥的内容会比公钥多一些，相比于公钥，私钥还有 <code>p,q,dp,dq,qinvp</code> 。</p><p>测试样例</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line">key = RSA.generate(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.pem&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="string">b&#x27;n = &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(key.n)[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">b&#x27;e = &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(key.e)[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">b&#x27;p = &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(key.p)[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">b&#x27;q = &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(key.q)[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">b&#x27;d = &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(key.d)[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">b&#x27;dp = &#x27;</span>+ <span class="built_in">str</span>(<span class="built_in">hex</span>((key.d) % ((key.p) - <span class="number">1</span>))[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">b&#x27;dq = &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>((key.d) % ((key.q) - <span class="number">1</span>))[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">b&#x27;p_q = &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">pow</span>(key.p,-<span class="number">1</span>,key.q))[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(<span class="string">b&#x27;q_p = &#x27;</span> + <span class="built_in">str</span>(<span class="built_in">hex</span>(<span class="built_in">pow</span>(key.q, -<span class="number">1</span>, key.p))[<span class="number">2</span>:]).encode() + <span class="string">b&#x27;\n&#x27;</span>)</span><br><span class="line">    f.write(key.exportKey(<span class="string">&#x27;PEM&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;1.pem&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="built_in">print</span>(f.read().decode())</span><br></pre></td></tr></table></figure><p>例如一个私钥文件</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICWwIBAAKBgQCw/aHmn+xs4OCJbVu1U0JhR/M4h42TYeVyR02wdtV+Dwt+CrE7</span><br><span class="line">JlZyKBCM+jOXx+tgoxZ6e/U+voP9iU4Fpdmyi/HE8U5ZZ6YH8Bzx8Qh8vM3QM8XU</span><br><span class="line">W4NGfg6N9VG7uVdwioOBbZ9AoOBYHjMdxoZ8O5AxO3Lp0rzkfQTUe9CQFwIDAQAB</span><br><span class="line">AoGAE+puYeOj+HpzebNXCvfT89tjSHykVy3AYlQYr18n1df+jI/KcqP1PUI53os2</span><br><span class="line">7ADggQ7I9D5nkchhVNGy+Fq5vLgdTRYZ859iT1h9i+bTwt7Uq2OfJR/NRkVcvaSv</span><br><span class="line">7UKHmF3AyzNOpSf2NunvYUSJ5n92jUuXdXkvqmeS3/FOWA0CQQDJbCjac+mVzCzZ</span><br><span class="line">U84s+7JXviTHPoN9GXZY3vr1tIBogwyftCa1+pVIYu7WTwwHzcKe9KU4GPbLCTYU</span><br><span class="line">45FJ0ejjAkEA4PK+h3cB65Oahwmxza1w7tugGNTXcLhMpJ8PCO65pG0wRIpp3doC</span><br><span class="line">TRLKdUUAcVromiiU8m/Mt8jwyhVxFMpGPQJAN6/uj47yapbbY253FxqzUOzh8DAJ</span><br><span class="line">XGHYxXNIgPvZcIuixtigxzkzYqLvk1KhadrqTtYmg57rRHEUgav09CrTrwJANTc3</span><br><span class="line">+7QbsC9rDycr+Qxe+yLZ7QXtMa1n9EnstKBFKrDqCkz0XpeEk9cuLi/0utxWyqFv</span><br><span class="line">Gyt3ssLGtAf+iHyRwQJAIWcJAM/jTFTMXNUrYK0fa0MMpNMrwnlDb6uyMn/4Q41g</span><br><span class="line">f3RB/34+gFrCRZEhMtasgaOkoHYP3VZQvqkXzyaycg==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p>读取 base64 转 hex (手动排版换行过后)</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">3082025b02010002818100</span><br><span class="line">b0fda1e69fec6ce0e0896d5bb553426147f338878d9361e572474db076d57e0f0b7e0ab13b26567228108cfa3397c7eb60a3167a7bf53ebe83fd894e05a5d9b28bf1c4f14e5967a607f01cf1f1087cbccdd033c5d45b83467e0e8df551bbb957708a83816d9f40a0e0581e331dc6867c3b90313b72e9d2bce47d04d47bd09017</span><br><span class="line">0203010001</span><br><span class="line">028180 13ea6e61e3a3f87a7379b3570af7d3f3db63487ca4572dc0625418af5f27d5d7fe8c8fca72a3f53d4239de8b36ec00e0810ec8f43e6791c86154d1b2f85ab9bcb81d4d1619f39f624f587d8be6d3c2ded4ab639f251fcd46455cbda4afed4287985dc0cb334ea527f636e9ef614489e67f768d4b9775792faa6792dff14e580d</span><br><span class="line">024100 c96c28da73e995cc2cd953ce2cfbb257be24c73e837d197658defaf5b48068830c9fb426b5fa954862eed64f0c07cdc29ef4a53818f6cb093614e39149d1e8e3</span><br><span class="line">024100 e0f2be877701eb939a8709b1cdad70eedba018d4d770b84ca49f0f08eeb9a46d30448a69ddda024d12ca754500715ae89a2894f26fccb7c8f0ca157114ca463d</span><br><span class="line">0240   37afee8f8ef26a96db636e77171ab350ece1f030095c61d8c5734880fbd9708ba2c6d8a0c7393362a2ef9352a169daea4ed626839eeb44711481abf4f42ad3af</span><br><span class="line">0240   353737fbb41bb02f6b0f272bf90c5efb22d9ed05ed31ad67f449ecb4a0452ab0ea0a4cf45e978493d72e2e2ff4badc56caa16f1b2b77b2c2c6b407fe887c91c1</span><br><span class="line">0240   21670900cfe34c54cc5cd52b60ad1f6b430ca4d32bc279436fabb2327ff8438d607f7441ff7e3e805ac245912132d6ac81a3a4a0760fdd5650bea917cf26b272</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>解析过程如下</p><table><thead><tr><th>内容</th><th>解析</th></tr></thead><tbody><tr><td>3082</td><td>标签头，81 表示后面接 1bytes，82 表示后接 2bytes 表示长度。</td></tr><tr><td>025e</td><td>后接 0x25e (606) bytes 的内容。</td></tr><tr><td>02010002</td><td>固定序列</td></tr><tr><td>81</td><td>81 表示后面接 1bytes，82 表示后接 2bytes 表示长度。</td></tr><tr><td>81</td><td>后面的模数 n 长度为 0x81bytes，但是其中 1bytes 为 00，故生成的模数二进制位数为 1024</td></tr><tr><td>b0fd-9017</td><td>模数 n 的 16 进制</td></tr><tr><td>0203010001</td><td>02 后接加密指数 e 的长度 03 即内容 010001</td></tr><tr><td>028180</td><td>81 表示后面接 1bytes 的长度信息，80 表示后接 0x80 (128) bytes 长度的信息</td></tr><tr><td>13ea-580d</td><td>私钥指数 d 的 16 进制</td></tr><tr><td>024100</td><td>起始序列</td></tr><tr><td>c96c-e8e3</td><td>p 的 16 进制</td></tr><tr><td>024100</td><td>起始序列</td></tr><tr><td>e0f2-463d</td><td>q 的 16 进制</td></tr><tr><td>0240</td><td>起始序列</td></tr><tr><td>37af-d3af</td><td>dp 的 16 进制</td></tr><tr><td>0240</td><td>起始序列</td></tr><tr><td>3537-91c1</td><td>dq 的 16 进制</td></tr><tr><td>0240</td><td>起始序列</td></tr><tr><td>2167-b272</td><td>q inv p</td></tr></tbody></table><h3 id="例题1-2022actf-impossible-rsa"><a class="anchor" href="#例题1-2022actf-impossible-rsa">#</a> 例题 1 2022ACTF impossible RSA</h3><p>附件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">flag = <span class="string">b&#x27;ACTF&#123;...&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = inverse(e, p)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> isPrime(q):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    n = p * q</span><br><span class="line">    public = RSA.construct((n, e))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;public.pem&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(public.exportKey(<span class="string">&#x27;PEM&#x27;</span>))</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;wb&quot;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(long_to_bytes(<span class="built_in">pow</span>(bytes_to_long(flag), e, n)))</span><br><span class="line">    <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>本题中的公钥就是以文件形式读取，读取公钥代码为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;public.pem&#x27;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    key = f.read()</span><br><span class="line">    rsakey = RSA.importKey(key)</span><br><span class="line">    n = rsakey.n</span><br><span class="line">    e = rsakey.e</span><br></pre></td></tr></table></figure><p>回到本题，题目给了 <code>p,q,e</code> 之间满足关系<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi><mo>≡</mo><msup><mi>e</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mtext></mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext></mtext><mi>p</mi></mrow><annotation encoding="application/x-tex">q\equiv e^{-1} \bmod p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.65819em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal">p</span></span></span></span>，写成等式得到<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><mi>q</mi><mo>=</mo><mn>1</mn><mo>+</mo><mi>k</mi><mi>p</mi></mrow><annotation encoding="application/x-tex">eq=1+kp</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal">e</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8888799999999999em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mord mathnormal">p</span></span></span></span>，可知 k 的大小与 e 差不多，可以尝试队 k 进行爆破再联立<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>n</mi><mo>=</mo><mi>p</mi><mo>×</mo><mi>q</mi></mrow><annotation encoding="application/x-tex">n=p\times q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.7777700000000001em;vertical-align:-.19444em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span></span></span></span> 两组等式解得 pq。</p><p>两式联立化简可得<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><msup><mi>p</mi><mn>2</mn></msup><mo>+</mo><mi>p</mi><mo>−</mo><mi>e</mi><mi>n</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">kp^{2}+p-en=0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mord"><span class="mord mathnormal">p</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.7777700000000001em;vertical-align:-.19444em"></span><span class="mord mathnormal">p</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.64444em;vertical-align:0"></span><span class="mord">0</span></span></span></span>，只需判断其判别式是否能开整次方即可，完整解答为</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r&#x27;public.pem&#x27;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    key = f.read()</span><br><span class="line">    rsakey = RSA.importKey(key)</span><br><span class="line">    n = rsakey.n</span><br><span class="line">    e = rsakey.e</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    c = f.read()</span><br><span class="line">    c = bytes_to_long(c)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1</span> &lt;&lt; <span class="number">16</span>)):</span><br><span class="line">    root = gmpy2.iroot(<span class="number">1</span> + <span class="number">4</span> * k * n * e,<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> root[<span class="number">1</span>] == <span class="literal">True</span>:</span><br><span class="line">        p = (<span class="number">1</span> + root[<span class="number">0</span>]) // (<span class="number">2</span> * k)</span><br><span class="line">        <span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">        q = n // p</span><br><span class="line">        phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">        d = gmpy2.invert(e,phi)</span><br><span class="line">        m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h3 id="例题2-2022蓝帽杯初赛corrupted_key"><a class="anchor" href="#例题2-2022蓝帽杯初赛corrupted_key">#</a> 例题 2 2022 蓝帽杯初赛 corrupted_key</h3><p>该题主要考察对私钥文件 pem 的读取理解，附件如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">key = RSA.generate(<span class="number">1024</span>)</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>,<span class="string">&#x27;wb&#x27;</span>).write(PKCS1_OAEP.new(key.publickey()).encrypt(flag))</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;priv.pem&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(key.exportKey(<span class="string">&#x27;PEM&#x27;</span>))</span><br></pre></td></tr></table></figure><p>平平无奇的附件，关键在私钥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIICXgIBAAKBgQDXFSUGqpzsBeUzXWtG9UkUB8MZn9UQkfH2Aw03YrngP0nJ3NwH</span><br><span class="line">UFTgzBSLl0tBhUvZO07haiqHbuYgBegO+Aa3qjtksb+bH6dz41PQzbn/l4Pd1fXm</span><br><span class="line">dJmtEPNh6TjQC4KmpMQqBTXF52cheY6GtFzUuNA7DX51wr6HZqHoQ73GQQIDAQAB</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">yQvOzxy6szWFheigQdGxAkEA4wFss2CcHWQ8FnQ5w7k4uIH0I38khg07HLhaYm1c</span><br><span class="line">zUcmlk4PgnDWxN+ev+vMU45O5eGntzaO3lHsaukX9461mA==</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br></pre></td></tr></table></figure><p>其中可以看出，私钥文件中间是有很大程度的缺失，首先进行原始数据读取，将 base64 编码转成 hex 看看</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">第一段：</span><br><span class="line">3082025e02010002818100d7152506aa9cec05e5335d6b46f5491407c3199fd51091f1f6030d3762b9e03f49c9dcdc075054e0cc148b974b41854bd93b4ee16a2a876ee62005e80ef806b7aa3b64b1bf9b1fa773e353d0cdb9ff9783ddd5f5e67499ad10f361e938d00b82a6a4c42a0535c5e76721798e86b45cd4b8d03b0d7e75c2be8766a1e843bdc6410203010001</span><br><span class="line">第二段：</span><br><span class="line">c90bcecf1cbab3358585e8a041d1b1024100e3016cb3609c1d643c167439c3b938b881f4237f24860d3b1cb85a626d5ccd4726964e0f8270d6c4df9ebfebcc538e4ee5e1a7b7368ede51ec6ae917f78eb598</span><br></pre></td></tr></table></figure><p>从第一段可以提取出数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">n = <span class="number">0xd7152506aa9cec05e5335d6b46f5491407c3199fd51091f1f6030d3762b9e03f49c9dcdc075054e0cc148b974b41854bd93b4ee16a2a876ee62005e80ef806b7aa3b64b1bf9b1fa773e353d0cdb9ff9783ddd5f5e67499ad10f361e938d00b82a6a4c42a0535c5e76721798e86b45cd4b8d03b0d7e75c2be8766a1e843bdc641</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br></pre></td></tr></table></figure><p>从第二段可以提取出数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">_dq = <span class="number">0xc90bcecf1cbab3358585e8a041d1b1</span></span><br><span class="line">qinvp = <span class="number">0xe3016cb3609c1d643c167439c3b938b881f4237f24860d3b1cb85a626d5ccd4726964e0f8270d6c4df9ebfebcc538e4ee5e1a7b7368ede51ec6ae917f78eb598</span></span><br></pre></td></tr></table></figure><p>题目给了提示建立方程组使用 coppersmith 恢复 dq，模数 n 为 1024 位，dq 已知后面 120 位，缺失了 392 位，缺失的 392 位如果能够构造出等式是可以成功通过 coppersmith 攻击恢复。将已知式写成等式列出</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi><msub><mi>d</mi><mi>q</mi></msub><mo>=</mo><mn>1</mn><mo>+</mo><mi>k</mi><mo>×</mo><mo stretchy="false">(</mo><mi>q</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">e{d_q}=1+k\times(q-1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.980548em;vertical-align:-.286108em"></span><span class="mord mathnormal">e</span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.77777em;vertical-align:-.08333em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mclose">)</span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mi>q</mi><mo>=</mo><mn>1</mn><mo>+</mo><mi>u</mi><mo>×</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">tq=1+u\times p</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.80952em;vertical-align:-.19444em"></span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">=</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.72777em;vertical-align:-.08333em"></span><span class="mord">1</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.66666em;vertical-align:-.08333em"></span><span class="mord mathnormal">u</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">×</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal">p</span></span></span></span> (其中 t 为逆元)</p><p>由于<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>d</mi><mi>q</mi></msub></mrow><annotation encoding="application/x-tex">{d_q}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.980548em;vertical-align:-.286108em"></span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span></span></span></span> 的位数和<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>q</mi></mrow><annotation encoding="application/x-tex">q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.625em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span></span></span></span> 类似，即<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span></span></span></span> 的大小与<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>e</mi></mrow><annotation encoding="application/x-tex">e</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">e</span></span></span></span> 接近，可以尝试爆破。再构造方程式</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><msup><mi>q</mi><mn>2</mn></msup><mo>−</mo><mi>q</mi><mo>≡</mo><mn>0</mn><mtext></mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext></mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">tq^{2}-q\equiv 0 \bmod n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.008548em;vertical-align:-.19444em"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.65819em;vertical-align:-.19444em"></span><span class="mord mathnormal" style="margin-right:.03588em">q</span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord">0</span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span></span></span></span></p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo stretchy="false">(</mo><mi>e</mi><msub><mi>d</mi><mi>q</mi></msub><mo>−</mo><mn>1</mn><msup><mo stretchy="false">)</mo><mn>2</mn></msup><mo>+</mo><mi>k</mi><mo stretchy="false">(</mo><mn>2</mn><mi>t</mi><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo stretchy="false">(</mo><mi>e</mi><msub><mi>d</mi><mi>q</mi></msub><mo>−</mo><mn>1</mn><mo stretchy="false">)</mo><mo>+</mo><mi>t</mi><msup><mi>k</mi><mn>2</mn></msup><mo>−</mo><msup><mi>k</mi><mn>2</mn></msup><mo>≡</mo><mn>0</mn><mtext></mtext><mo lspace="0.22em" rspace="0.22em"><mrow><mi mathvariant="normal">m</mi><mi mathvariant="normal">o</mi><mi mathvariant="normal">d</mi></mrow></mo><mtext></mtext><mi>n</mi></mrow><annotation encoding="application/x-tex">t(e{d_q}-1)^{2}+k(2t-1)(e{d_q}-1)+tk^{2}-k^{2}\equiv 0 \bmod n</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-.286108em"></span><span class="mord mathnormal">t</span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.064108em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="mopen">(</span><span class="mord">2</span><span class="mord mathnormal">t</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1.036108em;vertical-align:-.286108em"></span><span class="mord">1</span><span class="mclose">)</span><span class="mopen">(</span><span class="mord mathnormal">e</span><span class="mord"><span class="mord"><span class="mord mathnormal">d</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:.15139200000000003em"><span style="top:-2.5500000000000003em;margin-left:0;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight" style="margin-right:.03588em">q</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:.286108em"><span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-.25em"></span><span class="mord">1</span><span class="mclose">)</span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">+</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.897438em;vertical-align:-.08333em"></span><span class="mord mathnormal">t</span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin">−</span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.8141079999999999em;vertical-align:0"></span><span class="mord"><span class="mord mathnormal" style="margin-right:.03148em">k</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:.8141079999999999em"><span style="top:-3.063em;margin-right:.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right:.2777777777777778em"></span><span class="mrel">≡</span><span class="mspace" style="margin-right:.2777777777777778em"></span></span><span class="base"><span class="strut" style="height:.69444em;vertical-align:0"></span><span class="mord">0</span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span><span class="mbin"><span class="mord"><span class="mord mathrm">m</span><span class="mord mathrm">o</span><span class="mord mathrm">d</span></span></span><span class="mspace" style="margin-right:.05555555555555555em"></span><span class="mspace" style="margin-right:.2222222222222222em"></span></span><span class="base"><span class="strut" style="height:.43056em;vertical-align:0"></span><span class="mord mathnormal">n</span></span></span></span></p><p>爆破 k，dq 低位已知，构造方程式可解</p><p>这里发现一个问题，构造的时候 dq 要写成 <code>dq = (2 ** 120 * x) + _dq</code> 而不能写成 <code>dq = (x &lt;&lt; 120) + _dq</code> ，具体原因也不清楚为什么，写成后面的程序就运行得很慢。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line">n = <span class="number">0xd7152506aa9cec05e5335d6b46f5491407c3199fd51091f1f6030d3762b9e03f49c9dcdc075054e0cc148b974b41854bd93b4ee16a2a876ee62005e80ef806b7aa3b64b1bf9b1fa773e353d0cdb9ff9783ddd5f5e67499ad10f361e938d00b82a6a4c42a0535c5e76721798e86b45cd4b8d03b0d7e75c2be8766a1e843bdc641</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">_dq = <span class="number">0xc90bcecf1cbab3358585e8a041d1b1</span></span><br><span class="line">t = <span class="number">0xe3016cb3609c1d643c167439c3b938b881f4237f24860d3b1cb85a626d5ccd4726964e0f8270d6c4df9ebfebcc538e4ee5e1a7b7368ede51ec6ae917f78eb598</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.enc&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    c = f.read()</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">dq = (<span class="number">2</span> ** <span class="number">120</span> * x) + _dq</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">65537</span>,<span class="number">55000</span>,-<span class="number">1</span>)):</span><br><span class="line">    f = t * (e * dq - <span class="number">1</span>) ** <span class="number">2</span> + k * (<span class="number">2</span> * t - <span class="number">1</span>) * (e * dq - <span class="number">1</span>) + t * k * k - k * k</span><br><span class="line">    f = f.monic()</span><br><span class="line">    root = f.small_roots(X=<span class="number">2</span>^<span class="number">392</span>,beta=<span class="number">0.4</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(root) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">int</span>(root[<span class="number">0</span>]) * <span class="number">2</span> ** <span class="number">120</span> + _dq)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="comment">#dq = 11263269100321843418340309033584057768246046953115325020896491943793759194249558697334095131684279304657225064156696057310019203890620314290203835007881649</span></span><br><span class="line"><span class="comment">#k = 59199  </span></span><br></pre></td></tr></table></figure><p>得到 dq 和系数 k 之后，直接计算 flag，但是这里需要注意，原题是通过 PKCS1_OAEP 算法进行加解密的，在得到私钥之后也要通过原来的方式解密回去</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>,<span class="string">&quot;rb&quot;</span>)<span class="keyword">as</span> f:</span><br><span class="line">    c = f.read()</span><br><span class="line">dq = <span class="number">11263269100321843418340309033584057768246046953115325020896491943793759194249558697334095131684279304657225064156696057310019203890620314290203835007881649</span></span><br><span class="line">k = <span class="number">59199</span></span><br><span class="line">n = <span class="number">0xd7152506aa9cec05e5335d6b46f5491407c3199fd51091f1f6030d3762b9e03f49c9dcdc075054e0cc148b974b41854bd93b4ee16a2a876ee62005e80ef806b7aa3b64b1bf9b1fa773e353d0cdb9ff9783ddd5f5e67499ad10f361e938d00b82a6a4c42a0535c5e76721798e86b45cd4b8d03b0d7e75c2be8766a1e843bdc641</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">q = <span class="built_in">int</span>((e * dq - <span class="number">1</span>) // k + <span class="number">1</span>)</span><br><span class="line"><span class="keyword">assert</span> n % q == <span class="number">0</span></span><br><span class="line">p = <span class="built_in">int</span>(n // q)</span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">int</span>(gmpy2.invert(e,phi))</span><br><span class="line">key = RSA.construct((n,e,d,p,q))</span><br><span class="line">flag = PKCS1_OAEP.new(key)</span><br><span class="line">flag = flag.decrypt(c)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure><h3 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接</h3><p><span class="exturl" data-url="aHR0cHM6Ly93d3cuYmlsaWJpbGkuY29tL3JlYWQvY3YxMzM5MjM4Mi8=">https://www.bilibili.com/read/cv13392382/</span></p><p><span class="exturl" data-url="aHR0cHM6Ly96aC5tLndpa2lwZWRpYS5vcmcvemgtY24vT3BlblNTTA==">https://zh.m.wikipedia.org/zh-cn/OpenSSL</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3RvcGd1bl9jaGVubGluZ3l1bi9hcnRpY2xlL2RldGFpbHMvNDMyNzQ1MDE=">https://blog.csdn.net/topgun_chenlingyun/article/details/43274501</span></p></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">Edited on</span> <time title="Modified: 2022-07-28 10:01:30" itemprop="dateModified" datetime="2022-07-28T10:01:30+08:00">2022-07-28</time> </span><span id="2022/07/28/pem类文件解析及2022蓝帽杯crypto详解/" class="item leancloud_visitors" data-flag-title="pem类文件解析及2022蓝帽杯crypto详解" title="Views"><span class="icon"><i class="ic i-eye"></i> </span><span class="text">Views</span> <span class="leancloud-visitors-count"></span> <span class="text">times</span></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> Donate</button><p>Give me a cup of [coffee]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/Alipay.jpg" alt="tsuppari Alipay"><p>Alipay</p></div><div><img data-src="/images/WeChatpay.jpg" alt="tsuppari PayPal"><p>PayPal</p></div></div></div><div id="copyright"><ul><li class="author"><strong>Post author: </strong>tsuppari <i class="ic i-at"><em>@</em></i>蒟蒻的入土史</li><li class="link"><strong>Post link: </strong><a href="https://tsuppari404.github.io/2022/07/28/pem%E7%B1%BB%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E5%8F%8A2022%E8%93%9D%E5%B8%BD%E6%9D%AFcrypto%E8%AF%A6%E8%A7%A3/" title="pem类文件解析及2022蓝帽杯crypto详解">https://tsuppari404.github.io/2022/07/28/pem类文件解析及2022蓝帽杯crypto详解/</a></li><li class="license"><strong>Copyright Notice: </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpoLUNOLnltbA=="><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> unless stating additionally.</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2022/03/16/%E9%92%88%E5%AF%B9CTFer%E7%9A%84e%E4%B8%8Ephi%E4%B8%8D%E4%BA%92%E7%B4%A0%E7%9A%84%E9%97%AE%E9%A2%98/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;10&#x2F;30&#x2F;qAMYEFXxJcKRsiG.gif" title="针对CTFer的e与phi不互素的问题"><span class="type">Previous Post</span> <span class="category"><i class="ic i-flag"></i></span><h3>针对CTFer的e与phi不互素的问题</h3></a></div><div class="item right"><a href="/2022/11/26/docker%E6%98%AF%E4%B8%AA%E8%82%BE%E4%B9%88%E7%8E%A9%E6%84%8F/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;i.loli.net&#x2F;2020&#x2F;10&#x2F;30&#x2F;Z5W6r2BSoiThHG1.jpg" title="docker是个肾么玩意"><span class="type">Next Post</span> <span class="category"><i class="ic i-flag"></i></span><h3>docker是个肾么玩意</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="Contents"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#pem%E6%96%87%E4%BB%B6"><span class="toc-number">1.</span> <span class="toc-text">pem 文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%85%AC%E7%A7%81%E9%92%A5"><span class="toc-number">2.</span> <span class="toc-text">生成公私钥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#public-key"><span class="toc-number">2.1.</span> <span class="toc-text">public key</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#private-key"><span class="toc-number">2.2.</span> <span class="toc-text">private key</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%85%AC%E7%A7%81%E9%92%A5%E5%8A%A0%E5%AF%86%E6%88%96%E8%A7%A3%E5%AF%86%E6%96%87%E4%BB%B6"><span class="toc-number">3.</span> <span class="toc-text">使用公私钥加密或解密文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E6%9E%90%E5%85%AC%E7%A7%81%E9%92%A5"><span class="toc-number">4.</span> <span class="toc-text">解析公私钥</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#openssl"><span class="toc-number">4.1.</span> <span class="toc-text">openssl</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%85%AC%E9%92%A5pem"><span class="toc-number">4.1.1.</span> <span class="toc-text">读取公钥 pem</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E7%A7%81%E9%92%A5pem"><span class="toc-number">4.1.2.</span> <span class="toc-text">读取私钥 pem</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96"><span class="toc-number">4.2.</span> <span class="toc-text">原始数据读取</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E5%85%AC%E9%92%A5pem-2"><span class="toc-number">4.2.1.</span> <span class="toc-text">读取公钥 pem</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%AF%BB%E5%8F%96%E7%A7%81%E9%92%A5pem-2"><span class="toc-number">4.2.2.</span> <span class="toc-text">读取私钥 pem</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E9%A2%981-2022actf-impossible-rsa"><span class="toc-number">5.</span> <span class="toc-text">例题 1 2022ACTF impossible RSA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E9%A2%982-2022%E8%93%9D%E5%B8%BD%E6%9D%AF%E5%88%9D%E8%B5%9Bcorrupted_key"><span class="toc-number">6.</span> <span class="toc-text">例题 2 2022 蓝帽杯初赛 corrupted_key</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">7.</span> <span class="toc-text">参考链接</span></a></li></ol></div><div class="related panel pjax" data-title="Related"></div><div class="overview panel" data-title="Overview"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="tsuppari" data-src="/images/head.jpg"><p class="name" itemprop="name">tsuppari</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">20</span> <span class="name">posts</span></a></div><div class="item tags"><a href="/tags/"><span class="count">8</span> <span class="name">tags</span></a></div></nav><div class="social"><span class="exturl item email" data-url="bWFpbHRvOjE2MjcxMDA3NDEwQHFxLmNvbQ==" title="mailto:16271007410@qq.com"><i class="ic i-envelope"></i></span> <span class="exturl item QQ" data-url="dGVuY2VudDovL01lc3NhZ2UvP1Vpbj0xNjI3MTAwNDEwJndlYnNpdGVOYW1lPXEtem9uZS5xcS5jb20mTWVudT15ZXM=" title="tencent:&#x2F;&#x2F;Message&#x2F;?Uin&#x3D;1627100410&amp;websiteName&#x3D;q-zone.qq.com&amp;Menu&#x3D;yes"><i class="ic i-qq"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>Home</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>About</a></li><li class="item"><a href="/friends/" rel="section"><i class="ic i-heart"></i>friends</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2022/03/16/%E9%92%88%E5%AF%B9CTFer%E7%9A%84e%E4%B8%8Ephi%E4%B8%8D%E4%BA%92%E7%B4%A0%E7%9A%84%E9%97%AE%E9%A2%98/" rel="prev" title="Previous Post"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2022/11/26/docker%E6%98%AF%E4%B8%AA%E8%82%BE%E4%B9%88%E7%8E%A9%E6%84%8F/" rel="next" title="Next Post"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>Random Posts</h2><ul><li class="item"><div class="breadcrumb"></div><span><a href="/2021/06/08/%E6%9D%82_%E9%9D%9E%E5%B8%B8%E6%9D%82/" title="杂_非常杂">杂_非常杂</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/07/28/pem%E7%B1%BB%E6%96%87%E4%BB%B6%E8%A7%A3%E6%9E%90%E5%8F%8A2022%E8%93%9D%E5%B8%BD%E6%9D%AFcrypto%E8%AF%A6%E8%A7%A3/" title="pem类文件解析及2022蓝帽杯crypto详解">pem类文件解析及2022蓝帽杯crypto详解</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2021/08/02/%E8%92%9F%E8%92%BB%E7%9A%84%E6%8C%A8%E6%89%93%E4%B9%8B%E8%B7%AF/" title="蒟蒻的挨打之路">蒟蒻的挨打之路</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/11/01/%E7%AC%AC%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/" title="第一篇博客">第一篇博客</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2099/09/12/crypto%E7%9A%84%E6%8C%A8%E6%89%93%E4%B9%8B%E8%B7%AF(%E4%B8%80)/" title="crypto的挨打之路（一）">crypto的挨打之路（一）</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/12/20/%E7%94%BB%E4%B8%80%E4%B8%AA%E5%8F%A5%E5%8F%B7/" title="画一个句号">画一个句号</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2020/11/02/%E6%AD%A5%E5%85%A5CTF%E7%9A%84%E7%AC%AC%E4%B8%80%E5%A4%A9/" title="步入CTF的第一天">步入CTF的第一天</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2021/01/25/%E8%92%9F%E8%92%BB%E7%9A%84python%E7%AC%94%E8%AE%B0/" title="蒟蒻的python笔记（随缘更新版）">蒟蒻的python笔记（随缘更新版）</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/11/26/docker%E6%98%AF%E4%B8%AA%E8%82%BE%E4%B9%88%E7%8E%A9%E6%84%8F/" title="docker是个肾么玩意">docker是个肾么玩意</a></span></li><li class="item"><div class="breadcrumb"></div><span><a href="/2022/03/16/%E9%92%88%E5%AF%B9CTFer%E7%9A%84e%E4%B8%8Ephi%E4%B8%8D%E4%BA%92%E7%B4%A0%E7%9A%84%E9%97%AE%E9%A2%98/" title="针对CTFer的e与phi不互素的问题">针对CTFer的e与phi不互素的问题</a></span></li></ul></div><div><h2>Recent Comments</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2020 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">tsuppari @ T5uppari</span></div><div class="powered-by">Powered by <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2022/07/28/pem类文件解析及2022蓝帽杯crypto详解/",favicon:{show:"（●´3｀●）Goooood",hide:"(´Д｀)Booooom"},search:{placeholder:"Search for Posts",empty:"We didn't find any results for the search: ${query}",stats:"${hits} results found in ${time} ms"},valine:!0,fancybox:!0,copyright:'Copied to clipboard successfully! <br> All articles in this blog are licensed under <i class="ic i-creative-commons"></i>BY-NC-SA.',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->